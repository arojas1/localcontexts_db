{% load static %}{% load custom_project_tags %}
{% get_all_researchers as all_researchers %}
{% get_all_institutions as all_institutions %}

<div class="padding-bottom-1 flex-this row">
    <div>
        <label for="contributors">Project Contributors</label>
        <div class="tooltip"><strong>?</strong>
            <span class="tooltiptext">
                {% if institution or researcher %}
                    Key institutional or researcher contributors involved in the project. 
                    This can include other institutions or researchers.    
                {% endif %}       
                {% if community %}
                    Any institutional or researcher contributors involved in the project who are registered in the Hub.
                {% endif %}
            </span>
        </div>
        <br>
        <input id="contributor-input" list="contributors" name="contributors" placeholder="Select a contributor from the hub">
        <datalist id="contributors">
            {% if all_researchers %}
                {% for researcher in all_researchers %}
                    <option 
                        value="{% if researcher.user.get_full_name %} {{ researcher.user.get_full_name }} {% else %} {{ researcher.user.username }} {% endif %} (Researcher)" 
                        data-resid="{{ researcher.id }}"
                    >
                {% endfor %}
            {% endif %}
            {% if all_institutions %}
                {% for institution in all_institutions %}
                    <option value="{{ institution.institution_name }} (Institution)" data-instid="{{ institution.id }}">
                {% endfor %}
            {% endif %}
        </datalist>    
    </div>
    <div id="add-contributor-btn" class="add-square-btn pointer">
        <span>+</span>
    </div>
</div>

{% include 'partials/_add-projectperson.html'%}

<p>Selected Contributors</p>

<!-- If edit project -->
{% if contributors %}

    {% for researcher in contributors.researchers.all %}
        <div id="selected-researcher-{{ researcher.id }}" class="hide">
            <div class="grey-chip flex-this row space-between">
                <div><p class="center-name">
                    {% if researcher.user.get_full_name %}
                        {{ researcher.user.get_full_name }}
                    {% else %}
                        {{ researcher.user.username }}
                    {% endif %}
                </p></div>
                <div id="close-res-{{ researcher.id }}" class="close-x pointer" onclick="cancelResearcherSelection(this)"><div>&times;</div></div>
            </div>
        </div>
        <div id="res-id-input-{{ researcher.id }}" style="display: none;">
            <input type="hidden" value="{{ researcher.id }}" name="selected_researchers">
        </div>
    {% endfor %}

    {% for institution in contributors.institutions.all %}
        <div id="selected-institution-{{ institution.id }}" class="hide">
            <div class="grey-chip flex-this row space-between">
                <div><p class="center-name">{{ institution.institution_name }}</p></div>
                <div id="close-inst-{{ institution.id }}" class="close-x pointer" onclick="cancelInstitutionSelection(this)"><div>&times;</div></div>
            </div>
        </div>
        <div id="inst-id-input-{{ institution.id }}" style="display: none;">
            <input type="hidden" value="{{ institution.id }}" name="selected_institutions">
        </div>
    {% endfor %}
{% endif %}

<!-- If create project -->
<div class="flex-this">
    {% for researcher in all_researchers %}
        <div id="selected-researcher-{{ researcher.id }}" class="hide">
            <div class="grey-chip flex-this row space-between">
                <div><p class="center-name">
                    {% if researcher.user.get_full_name %}
                        {{ researcher.user.get_full_name }}
                    {% else %}
                        {{ researcher.user.username }}
                    {% endif %}
                </p></div>
                <div id="close-res-{{ researcher.id }}" class="close-x pointer" onclick="cancelResearcherSelection(this)"><div>&times;</div></div>
            </div>
        </div>
        <div id="res-id-input-{{ researcher.id }}" style="display: none;"></div>
    {% endfor %}

    {% for institution in all_institutions %}
        <div id="selected-institution-{{ institution.id }}" class="hide">
            <div class="grey-chip flex-this row space-between">
                <div><p class="center-name">{{ institution.institution_name }}</p></div>
                <div id="close-inst-{{ institution.id }}" class="close-x pointer" onclick="cancelInstitutionSelection(this)"><div>&times;</div></div>
            </div>
        </div>
        <div id="inst-id-input-{{ institution.id }}" style="display: none;"></div>
    {% endfor %}
</div>
