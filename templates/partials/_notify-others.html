{% load static %}

<div class="content-card-v2 content-card-space">
    <div class="flex-this space-between">
        <div>
            <h2 class="no-bottom-margin no-top-margin">Notify Communities</h2>
            <p>Once you have created a Project, you can send this Project to communities, institutions or researchers that could be interested in this Project.</p>
        </div>

        <div class="w-40 flex-this column align-right">
            <div class="flex-this margin-bottom-16 w-100 flex-end">
                <div><a href="{% url 'view-project' project.unique_id %}" class="primary-btn white-btn">View Project <i class="fa fa-arrow-right"></i></a></div>
            </div>
        </div>
    </div>

    <div class="flex-this space-between w-100">
        <div>
            <div><h3 class="no-bottom-margin no-top-margin">{{ project.title }}</h3></div>
            <div><p>{{ project.date_added|date:'M d, Y' }} | 
                {% if project.project_type == 'Other' %} {{ project.other_type }} {% else %} {{ project.project_type }} {% endif %}|
                {{ project.project_privacy }}
                </p>
            </div>

            {% if project.publication_doi %}
                <div class="margin-bottom-16">
                    <div><h3 class="no-top-margin">Project DOI</h3></div>
                    
                    <a 
                        class="darkteal-text underline-hover"
                        {% if not 'https://' in project.publication_doi %}
                            href="https://doi.org/{{ project.publication_doi }}"
                        {% else %}
                            href="{{ project.publication_doi }}"
                        {% endif %}
                    >
                    {{ project.publication_doi }} <i class="fa fa-external-link" aria-hidden="true"></i>
                    </a>
                </div> 
            {% endif %}
            
        </div>
        <div class="flex-this flex-end">
            {% if project.project_notice.all %}
                {% for notice in project.project_notice.all %}
                    {% if not notice.archived %}
                        {% if notice.notice_type == 'biocultural' %}
                            <div class="margin-left-8"><img loading="lazy" src="{% static 'images/notices/bc-notice.png' %}" width="62px"></div>
                        {% endif %}
                        {% if notice.notice_type == 'traditional_knowledge' %}
                            <div class="margin-left-8"><img loading="lazy" src="{% static 'images/notices/tk-notice.png' %}" width="62px"></div>
                        {% endif %}
                        {% if notice.notice_type == 'attribution_incomplete' %}
                            <div class="margin-left-8"><img loading="lazy" src="{% static 'images/notices/ci-attribution-incomplete.png' %}" width="62px"></div>
                        {% endif %}
                    {% endif %}
                {% endfor %}
            {% endif %}
        </div>   
    </div>
</div>


<div class="content-card-v2 content-card-space">

    <h3 class="no-top-margin">Send Requests</h3>
    <p>
        By notifying relevant communities, they are able to see what this Project is and decide whether or not they would like to add their Labels to this Project. After your organization has entered the communities you would like to to send these requests to, you can monitor and communicate with them in the requests section.<br><br>
    </p>

    <form method="POST" action="">
        {% csrf_token %}

        {% if communities %}
            <label>Search the Local Contexts Hub registry</label><br>

            <div class="flex-this space-between w-80">
                <div class="w-100 margin-right-8">
                    <select id="communities-select" class="w-100" onchange="selectCommunities()">
                        <option>Select a Community</option>

                        {% for community in communities %}
                            {% if project.project_status.all %}
                                {% for status in project.project_status.all %}
                                    {% if status.community == community %}
                                    {% else %}
                                        <option id="{{ community.id }}">{{ community.community_name }}</option>
                                    {% endif %}
                                {% endfor %}
                            {% else %}
                                <option id="{{ community.id }}">{{ community.community_name }}</option>
                            {% endif %}
                        {% endfor %}
                    </select>                    
                </div>
            </div>

            <div class="flex-this margin-top-16">
                {% for community in communities %}
                    <div id="selected-community-{{ community.id }}" class="hide">
                        <div class="grey-chip flex-this row space-between">
                            <div><p class="center-name">{{community.community_name}}</p></div>
                            <div id="close-{{ community.id }}" class="close-x pointer" onclick="cancelCommunitySelection(this)"><div>&times;</div></div>
                        </div>
                    </div>
                    <div id="comm-id-input-{{ community.id }}" style="display: none;"></div>
                {% endfor %}
            </div>

        {% endif %}
    
        <div class="margin-top-16 w-80">
            <div>
                <label>Send a message with this request</label><br>
                <textarea name="notice_message" class="w-100" style="height:150px;"></textarea>
            </div>

            <div class="flex-this flex-end margin-top-16">
                <button class="primary-btn action-btn">Send Notification <i class="fa fa-users" aria-hidden="true"></i></button>
            </div>
        </div>
        
    </form>
</div>
  