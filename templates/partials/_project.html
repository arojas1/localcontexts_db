{% load static %}

<div class="content-card-v2 content-card-space white-bg">
    <div class="flex-this space-between">
        <div class="flex-this column w-100">
            <div class="margin-top-1">
                <p class="p-24 bold">Project Archive</p>
                <p>Listed below is an archive of all of the information that is associated with this project.<br>
                    If you would like to edit this project again, you can do so until a community has applied a Label to this project. </p>
            </div>
        </div>
        <!-- <div class="flex-this w-30">
            <div class="margin-left-1"><a class="action-btn margin-top-2 ">Share Project <i class="fa fa-share-alt" aria-hidden="true"></i></a></div>
        </div> -->
    </div>
</div>

<div class="content-card-v2 content-card-space white-bg">
    
    <div class="flex-this margin-right-1 margin-left-1">
        <div class="flex-this column w-60">
            <div><p class="p-28 bold">{{ project.title }}</p></div>
            <div><p class="bold">{{ project.date_added|date:'d F Y' }} | {{ project.project_type }} | {{ project.project_privacy }}</p></div>

            <div>
                <p class="p-24 bold no-top-margin">Project Information</p>
                <span class="bold">Project description</span><br>
                <p>{{ project.description }}</p>
            </div>

            <div>
                <p class="bold">Project contact details</p>
                <p>
                    Name | {{ project.project_contact }} <br>
                    Email | {{ project.project_contact_email }}
                </p>
            </div>

            <div>
                <p class="bold">Project contributors</p>
                <p>
                    <ul>
                        {% if project.project_contributors.communities %}
                            {% for community in project.project_contributors.communities.all %}
                                <li>{{ community.community_name }} | Community</li>
                            {% endfor %}
                        {% endif %}

                        {% if project.project_contributors.institutions %}
                            {% for institution in project.project_contributors.institutions.all %}
                                <li>{{ institution.institution_name }} | Institution <br></li>
                            {% endfor %}
                        {% endif %}

                        {% if project.project_contributors.researchers %}
                            {% for researcher in project.project_contributors.researchers.all %}
                                <li>{{ researcher.user.get_full_name }} | Researcher <br></li>
                            {% endfor %}
                        {% endif %}
                        {% if project.additional_contributors %}
                            {% for contributor in project.additional_contributors.all %}
                                <li>{{ contributor.name }} | Contributor </li>
                            {% endfor %}
                        {% endif %}
                    </ul>
                </p>
            </div>

            <div>
                <p class="p-24 bold no-bottom-margin">Project Identifiers</p>

                <div class="flex-this space-between">
                    <div><p><span class="bold">Local Contexts Unique Project ID</span> <br><span id="uniqueIDToCopy">{{ project.unique_id }}</span><br></p></div>
                    <div class="margin-top-1">
                        {% if project.unique_id %}
                            <a onclick="copyToClipboard()" class="action-btn margin-top-2  copied-display">Copy ID <i class="fa fa-copy"></i></a>
                        {% endif %}
                    </div>
                </div>

                <div class="flex-this space-between">
                    <div><p><span class="bold">Project DOI</span> <br>{{ project.publication_doi }} <br></p></div>
                    <div class="margin-top-1">
                        {% if project.publication_doi %}
                            {% if 'https://' not in project.publication_doi %}
                                <a href="https://www.doi.org/{{ project.publication_doi }}" class="action-btn margin-top-2 ">Project DOI <i class="fa fa-external-link" aria-hidden="true"></i></a>
                            {% endif %}
                        {% endif %}
                    </div>
                </div>

                <div class="flex-this space-between">
                    <div><p><span class="bold">Project Data GUID</span><br> {{ project.project_data_guid }}<br></p></div>
                    <div class="margin-top-1">
                        {% if project.project_data_guid %}
                            <a href="#" class="action-btn margin-top-2 ">Copy GUID <i class="fa fa-external-link" aria-hidden="true"></i></a>
                        {% endif %}
                    </div>
                </div>

                <div><p><span class="bold">Recommended Citation</span><br> {{ project.recommended_citation }}<br></p></div>

            </div>
        </div>
        
        <!-- PROJECT IMAGES -->
        <div class="w-40 flex-this column">
            <div class="text-align-right margin-top-16">

                {% if project.project_image %}
                    <div><img src="{{ project.project_image.url }}" width="320px" height="180px"></div>
                {% else %}
                    <div class="w-100">
                        <img src="{% static 'images/placeholders/placeholder-img.png' %}" width="320px" height="180px">
                    </div>
                    <div class="flex-this w-100">
                        <div class="flex-this row space-between w-70" style="margin-left:auto; width: 320px;">
                            <div class="margin-right-1">
                                <img src="{% static 'images/placeholders/placeholder-img.png' %}" width="74px" height="42px">
                            </div>
                            <div class="margin-right-1">
                                <img src="{% static 'images/placeholders/placeholder-img.png' %}" width="74px" height="42px">
                            </div>
                            <div class="margin-right-1">
                                <img src="{% static 'images/placeholders/placeholder-img.png' %}" width="74px" height="42px">
                            </div>
                            <div>
                                <img src="{% static 'images/placeholders/placeholder-img.png' %}" width="74px" height="42px">
                            </div>
                        </div>
                    </div>
                {% endif %}

            </div>
        </div>
    
    </div>

        {% if project.project_notice.all %}
            <div class="margin-right-1 margin-left-1">

                {% for notice in project.project_notice.all %}
                {% if notice.archived %} {% else %}
                    <div><p class="p-24 bold">Project Notice</p></div>

                    {% if notice.notice_type == 'biocultural' or notice.notice_type == 'biocultural_and_traditional_knowledge' %}
                        <div class="flex-this border-top-solid-teal border-bottom-solid-teal">
                            <div class="w-15 pad-top-1"><img src="{{ notice.bc_img_url }}" width="78" height="78" alt="black square with white letters BC in the middle"></div>
                            <div class="w-80 pad-top-1">
                                <h3 class="weight-500 no-top-margin">Biocultural Notice</h3>
                                <p>{{ notice.bc_default_text}}</p>
                            </div>
                        </div>
                    {% endif %}

                    {% if notice.notice_type == 'traditional_knowledge' or notice.notice_type == 'biocultural_and_traditional_knowledge' %}
                        <div class="flex-this border-top-solid-teal border-bottom-solid-teal">
                            <div class="w-15 pad-top-1"><img src="{{ notice.tk_img_url }}" width="78" height="78" alt="black square with white letters TK in the middle"></div>
                            <div class="w-80 pad-top-1">
                                <h3 class="weight-500 no-top-margin">Traditional Knowledge Notice</h3>
                                <p>{{ notice.tk_default_text}}</p>
                            </div>
                        </div>
                    {% endif %}
                {% endif %}
                    
                {% endfor %}
            </div>
        {% endif %}

    {% if project.bc_labels.all or project.tk_labels.all %}
        <div class="margin-right-1 margin-left-1">
            <div><p class="p-24 bold">Project Labels</p></div>

        {% if project.bc_labels.all %}
            {% for bclabel in project.bc_labels.all %}
                <div>
                    <div class="flex-this">
                        <div class="small-label pad-top-1-5">
                            {% include 'bclabels/which-label.html' %}
                        </div>
                        <div class="pad-left-2">
                            <p class="darkteal-text">Label shared by {{ bclabel.community.community_name }} </p>
                            <p class="weight-500"> {{ bclabel.name }} </p>
                            <p>{{ bclabel.default_text}}</p>

                            {% include 'partials/_label-translation.html' %}
                        </div>
                    </div>
                    <div class="border-bottom-solid-teal margin-top-1"></div>
                </div>
            {% endfor %}
        {% endif %}

        {% if project.tk_labels.all %}
            {% for tklabel in project.tk_labels.all %}
                <div>
                    <div class="flex-this">
                        <div class="small-label pad-top-1-5">
                            {% include 'tklabels/which-label.html' %}
                        </div>
                        <div class="pad-left-2">
                            <p class="darkteal-text">Label shared by {{ tklabel.community.community_name }} </p>
                            <p class="weight-500"> {{ tklabel.name }} </p>
                            <p>{{ tklabel.default_text}}</p>

                            {% include 'partials/_label-translation.html' %}
                        </div>
                    </div>
                    <div class="border-bottom-solid-teal margin-top-1"></div>
                </div>
            {% endfor %}
        {% endif %}

        </div>
    {% endif %}

</div>

<!-- TODO: add users that are also contributors -->
{% if project.project_creator == request.user %}
    {% if project.project_comment.all %}
        <div class="content-card-v2 content-card-space white-bg">

            <h3>Comments History</h3>
            <div>
                {% if project.project_status.all %}
                    {% for status in project.project_status.all %}

                        <div class="flex-this space-between w-100 margin-top-16">
                            <div><p><span class="bold">{{ status.community }}</span></p></div>
                            <div><p class="grey-text"><em>Status: 
                                {% if status.seen and status.status == None %} Seen
                                {% elif status.seen and status.status == 'pending' %} Labels Pending
                                {% elif status.seen and status.status == 'not_pending' %} No Labels Pending
                                {% else %} Sent
                                {% endif %}</em></p></div>    
                        </div>

                        {% if status.community.comment_community.all %}
                            {% for comment in status.community.comment_community.all %}
                                <div>
                                    <span class="weight-500">{{ comment.sender.get_full_name }}</span>
                                    <span class="grey-text">{{ comment.created|date:'m/d/Y' }}</span><br>
                                    <p>{{ comment.message }}</p>
                                </div>
                            {% endfor %}
                        {% endif %}

                    {% endfor %}
                {% endif %}
            </div>

        </div>
    {% endif %}
{% endif %}