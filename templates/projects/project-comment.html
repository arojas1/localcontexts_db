{% load static %}
<div class="border-top-solid-teal">

    <!-- RESEARCHER AND INSTITUTION -->
    {% if researcher or institution %}
        {% if project.project_status.all %}
        <h3 class="no-bottom-margin">Project Messages</h3>
            {% for status in project.project_status.all %}
                <div class="flex-this space-between w-100 margin-top-16">
                    <div><p><span class="bold">{{ status.community }}</span></p></div>
                    <div>
                        <p class="grey-text"><em>Status: 
                            {% if status.seen and status.status == None %} Seen
                            {% elif status.seen and status.status == 'pending' %} Labels Pending
                            {% elif status.seen and status.status == 'not_pending' %} No Labels Pending
                            {% else %} Sent
                            {% endif %}</em>
                        </p>
                    </div>    
                </div>

                <!-- TODO: FIX THIS, ORGANIZE MESSAGES BY COMMUNITY -->
                {% if project.project_comment.all %}
                    {% for comment in project.project_comment.all %}
                        {% if comment.community.community_name in status.community.community_name %}
                            <div class="flex-this w-80 project-comment">
                                <div class="project-comment-teal"></div>
                                <div class="project-comment-text">
                                    <span class="bold">{{ comment.sender.get_full_name }}</span>
                                    <span class="grey-text">{{ comment.created|date:'m/d/Y' }}</span><br>
                                    <p>{{ comment.message }}</p>
                                </div>
                            </div>
                        {% endif %}
                    {% endfor %}
                {% endif %}

                {% if member_role == 'viewer' %} {% else %}
                    <form method="POST" action="">
                        {% csrf_token %}
                        <input type="hidden" value="{{ status.community.id }}" name="community-id">
                        <input type="hidden" value="{{ project.unique_id }}" name="project-uuid">
                        <div class="flex-this row">
                            <div class="w-50">{{ form.message }}</div>
                            <div class="margin-left-1"><button class="primary-btn action-btn" name="add-comment-btn">Send</button></div>
                        </div>
                        {% if form.errors %}
                            <small class="red-text"> {{ form.errors }}</small>
                        {% endif %}
                    </form>
                {% endif %}  

            {% endfor %}
        {% endif %}
    {% endif %}

    <!-- COMMUNITY  -->
    {% if community %}
        {% if project.project_comment.all %}
            <h3 class="no-bottom-margin">Project Messages</h3>
            <div>
                <p><span class="bold">
                    {% if project.project_notice.placed_by_researcher %} {{ project.project_notice.placed_by_researcher.user.get_full_name }} {% endif %}
                    {% if project.project_notice.placed_by_institution %} {{ project.project_notice.placed_by_institution.institution_name }} {% endif %}
                </span></p>
            </div>

            {% for comment in project.project_comment.all %}
                {% if community == comment.community %}
                    <div class="flex-this w-80 project-comment">
                        <div class="project-comment-teal"></div>
                        <div class="project-comment-text">
                            <span class="bold">{{ comment.sender.get_full_name }}</span>
                            <span class="grey-text">{{ comment.created|date:'m/d/Y' }}</span><br>
                            <p>{{ comment.message }}</p>
                        </div>
                    </div>
                {% endif %}
            {% endfor %}

            {% if member_role == 'viewer' %} {% else %}
                <form method="POST" action="">
                    {% csrf_token %}
                    <!-- <input type="hidden" value="{{ notice.id }}" name="notice-id"> -->
                    <input type="hidden" value="{{ project.unique_id }}" name="project-uuid">
                    <div class="flex-this row">
                        <div class="w-50">{{ form.message }}</div>
                        <div class="margin-left-1"><button class="primary-btn action-btn" name="add-comment-btn">Send</button></div>
                    </div>
                    {% if form.errors %}
                        <small class="red-text"> {{ form.errors }}</small>
                    {% endif %}
                </form>
            {% endif %}  
        {% endif %}
    {% endif %}

</div>
