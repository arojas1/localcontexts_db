{% extends 'base.html' %} {% block title %} | Projects {% endblock %} {% load static %} {% load custom_project_tags %} {% block content %}

<div id="full-div-card-{{ project.unique_id }}" class="content-card-v2 content-card-space white-bg">
    <div id="project-unique-{{ project.unique_id }}" class="flex-this space-between" style="scroll-margin-top: 8em;">

        <div class="w-60 flex-this column">
            <!-- title -->
            <div><h2 class="no-bottom-margin no-top-margin">{{ project.title }}</h2></div>
            <div><p>{{ project.date_added|date:'M d, Y' }} | 
                {{ project.project_type }} | 
                {{ project.project_privacy }}<br>
                Created: {{ project.project_creator.get_full_name }} 
                {% if project.community_projects.all %} {% for community in project.community_projects.all %} at {{ community }} | Community {% endfor %} {% endif %}
                {% if project.institution_projects.all %} {% for institution in project.institution_projects.all %} at {{ institution }} | Institution {% endfor %} {% endif %}
                {% if project.researcher_projects.all %} {% for researcher in project.researcher_projects.all %} | Researcher {% endfor %} {% endif %}
                </p>
            </div>
            
            <div class="margin-bottom-16">
                <div class="flex-this">
                    {% if project.publication_doi %}
                        <div class="margin-right-1">
                            {% if not 'https://' in project.publication_doi %}
                                <a href="https://doi.org/{{ project.publication_doi }}" class="primary-btn green-btn">{{ project.publication_doi }} <i class="fa fa-external-link" aria-hidden="true"></i></a></div>
                            {% else %}
                                <a href="{{ project.publication_doi }}" class="primary-btn green-btn">{{ project.publication_doi }} <i class="fa fa-external-link" aria-hidden="true"></i></a></div>
                            {% endif %}
                    {% endif %}
                    {% if project.url %}
                        <div><a href="{{ project.url }}" class="primary-btn green-btn">Project Link <i class="fa fa-external-link" aria-hidden="true"></i></a></div>
                    {% endif %}
                </div>
            </div>
        </div>

        <div class="w-40 flex-this column align-right margin-top-16">
            <div class="flex-this margin-bottom-8 w-100 flex-end">
                
                {% if community %}
                    {% if member_role == 'viewer' %}
                    {% else %}
                        <div class="margin-right-1">
                            <a href="{% url 'apply-labels' community.id project.unique_id %}" class="primary-btn action-btn">Apply Labels <i class="fa fa-plus" aria-hidden="true"></i> </a>
                        </div>
                    {% endif %}
                {% endif%}

                <div class="margin-right-1">
                    <a href="{% url 'view-project' project.unique_id %}" class="primary-btn white-btn">View Project <i class="fa fa-long-arrow-right"></i></a>
                </div>

                <div class="text-align-right">
                    <div class="primary-btn white-btn"><a id="{{ project.unique_id }}" onclick='showMore(this)'>
                            Show More <i class="fa fa-angle-down" aria-hidden="true"></i></a>
                    </div>
                </div>

                <div class="dropdown">
                    <a onclick="toggleMeatballMenu(this)" id="meatball-{{ project.unique_id }}" class="meatball"><i class="fa fa-ellipsis-h" style="font-size: 24px;"></i></a>
                    <div id="meatball-content-{{ project.unique_id }}" class="meatball-dropdown-content hide"> 

                        {% if project.bc_labels.all or project.tk_labels.all %}{% else %}
                                {% if request.user == project.project_creator %}
                                    <span>
                                        <div class="margin-right-1">
                                            <a
                                                class="darkteal-text"

                                                {% if community %}
                                                    href="{% url 'edit-project' community.id project.unique_id %}"
                                                {% endif %}
                                                {% if institution %}
                                                    href="{% url 'inst-edit-project' institution.id project.unique_id %}"
                                                {% endif %}                        
                                                {% if researcher %}
                                                    href="{% url 'researcher-edit-project' researcher.id project.unique_id %}"
                                                {% endif %}   
                                            >
                                                Edit Project <i class="fa fa-edit" aria-hidden="true"></i>
                                            </a>                   
                                        </div>                                        
                                    </span>
                                {% endif %}   
                        {% endif %}
                        
                        <span>
                            <a class="darkteal-text" href="{% url 'download-project-zip' project.unique_id %}">
                                Download <i class="fa fa-download" aria-hidden="true"></i>
                            </a>                                          
                        </span>
                    </div>
                </div>

            </div>

            <div class="flex-this row margin-top-8 w-50 flex-end">
                {% if project.tk_labels.all or project.bc_labels.all %}
                    {% if project.tk_labels.all %}
                        {% for tklabel in project.tk_labels.all %}
                            {% include 'tklabels/mini-labels.html' %}
                        {% endfor %}
                    {% endif %}

                    {% if project.bc_labels.all %}
                        {% for bclabel in project.bc_labels.all %}
                            {% include 'bclabels/mini-labels.html' %}
                        {% endfor %}
                    {% endif %}
                {% else %}
                    <div class="flex-this flex-end w-60">
                        {% if project.project_notice.all %}
                                {% for notice in project.project_notice.all %}
                                    {% if notice.notice_type == 'biocultural' %}
                                        <div class="margin-right-8"><img src="{% static 'images/notices/bc-notice.png' %}" height="72px" width="72px"></div>
                                    {% elif notice.notice_type == 'traditional_knowledge' %}
                                        <div class="margin-right-8"><img src="{% static 'images/notices/tk-notice.png' %}" height="72px" width="72px"></div>
                                    {% elif notice.notice_type == 'biocultural_and_traditional_knowledge' %}
                                        <div class="margin-right-8"><img src="{% static 'images/notices/bc-notice.png' %}" height="72px" width="72px"></div>
                                        <div class="margin-right-8"><img src="{% static 'images/notices/tk-notice.png' %}" height="72px" width="72px"></div>
                                    {% endif %}
                                {% endfor %}
                        {% endif %}

                        {% if project.project_institutional_notice.all %}
                            {% for notice in project.project_institutional_notice.all %}
                                {% if notice.notice_type == 'attribution_incomplete' %}
                                    <div><img src="{% static 'images/notices/ci-notice-attribution-incomplete.png' %}" height="72px" width="72px"></div>
                                {% elif notice.notice_type == 'open_to_collaborate' %}
                                    <div><img src="{% static 'images/notices/ci-notice-open-to-collaborate.png' %}" height="72px" width="72px"></div>
                                {% elif notice.notice_type == 'open_to_collaborate_and_attribution_incomplete' %}
                                    <div class="margin-right-8"><img src="{% static 'images/notices/ci-notice-attribution-incomplete.png' %}" height="72px" width="72px"></div>
                                    <div><img src="{% static 'images/notices/ci-notice-open-to-collaborate.png' %}" height="72px" width="72px"></div>
                                {% endif %}
                            {% endfor %}
                        {% endif %}
                        
                    </div>
                {% endif %}

            </div>
        </div>

    </div>

    <div id="expand-div-{{ project.unique_id }}" class="hide">

        <div class="w-70">
            <h3>Project Description</h3>
            <p>{{ project.description }}</p>
        </div>

        {% if researcher or institution %}
            <div class="flex-this space-between border-top-solid-teal">

                <div class="w-70 margin-top-16">
                    <h3 class="no-bottom-margin no-top-margin">Notify Communities</h3>
                    <p>
                        Listed below is an overview of the communities you have notified for this Project. Here you can monitor the status on their decision that they make based on this Project. The formal replies might be... <br><br>
                        <strong>Labels Pending:</strong> Which means that the community is going to apply Labels to this Project or..<br>
                        <strong>No - Labels Pending:</strong> Which means that the community is not going to apply Labels to this Project.<br><br>
                        You can message these communities directly in this section. Please remember to be kind. 
                    </p>
                </div>

                <div class="flex-this flex-end w-40 margin-top-16">
                    {% if institution %}
                        {% if institution.is_approved == False %}
                            <small class="margin-right-1 w-50 no-top-margin">In order to notify communities of your Project, your institution must be confirmed first.</small>
                        {% else %}
                            {% if project in institution.projects.all %}
                                {% if member_role == 'viewer' %}
                                {% else %}
                                    <div class="margin-right-1">
                                        <a href="{% url 'institution-notify-others' institution.id project.id %}" class="primary-btn action-btn">
                                            Notify Communities <i class="fa fa-users" aria-hidden="true"></i>
                                        </a>
                                    </div>
                                {% endif %}
                            {% endif %}
                        {% endif %}
                    {% endif %}

                    {% if researcher %}
                        {% if project in researcher.projects.all %}
                            <div class="margin-right-1">
                                <a href="{% url 'researcher-notify-others' researcher.id project.id %}" class="primary-btn action-btn">
                                    Notify Communities <i class="fa fa-users" aria-hidden="true"></i>
                                </a>
                            </div>
                        {% endif %}
                    {% endif %}
                </div>            
            </div>
        {% endif %}

        <div class="flex-this column">

            {% which_communities_notified project as statuses %}
            {% if statuses %}
                <div>
                    <p>
                        <span class="bold">Communities Notified - Status</span><br>
                        {% for status in statuses %}
                            {{ status.community.community_name }} -- 
                            {% if not status.seen and status.status == None %} Sent <br>{% endif %}
                            {% if status.seen and status.status == None %} Seen <br>{% endif %}                            
                            {% if status.seen and status.status == 'pending' %} Labels Pending <br>{% endif %}
                            {% if status.seen and status.status == 'not_pending' %} No Labels Pending <br>{% endif %}
                        {% endfor %}
                    </p>
                </div>
            {% endif %}

            {% if community %}
                {% if project in community.projects.all %} {% else %}
                    {% include 'projects/project-status.html'%}
                {% endif %}
            {% endif %}


            {% if project.project_notice.all %}
                {% for notice in project.project_notice.all %}
                    {% include 'projects/project-comment.html'%}
                {% endfor %}
            {% endif %}  
        </div>
    
    </div>


</div>

{% endblock%}