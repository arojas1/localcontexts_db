{% extends 'base.html' %} {% block title %} | Projects {% endblock %} {% load static %} {% load custom_project_tags %} {% block content %}

<div class="content-card-v2 content-card-space white-bg">
    <div id="project-unique-{{ project.unique_id}}" class="flex-this space-between" style="scroll-margin-top: 8em;">

        <div class="w-60 flex-this column">
            <!-- title -->
            <div><h3 class="no-bottom-margin no-top-margin">{{ project.title }}</h3></div>
            <div><p>{{ project.date_added|date:'M d, Y' }} | 
                {{ project.project_type }} | 
                {{ project.project_privacy }}
                </p>
            </div>
            
            <div class="margin-bottom-16">
                <div class="flex-this">
                    {% if project.publication_doi %}
                        <div class="margin-right-1">
                            {% if not 'https://' in project.publication_doi %}
                                <a href="https://doi.org/{{ project.publication_doi }}" class="green-btn">{{ project.publication_doi }} <i class="fa fa-external-link" aria-hidden="true"></i></a></div>
                            {% else %}
                                <a href="{{ project.publication_doi }}" class="green-btn">{{ project.publication_doi }} <i class="fa fa-external-link" aria-hidden="true"></i></a></div>
                            {% endif %}
                    {% endif %}
                    {% if project.url %}
                        <div><a href="{{ project.url }}" class="green-btn">Project Link <i class="fa fa-external-link" aria-hidden="true"></i></a></div>
                    {% endif %}
                </div>
            </div>

            {% which_communities_notified project as statuses %}
            {% if statuses %}
                <div>
                    <p>
                        <span class="bold">Communities Notified</span><br>
                        {% for status in statuses %}
                            {{ status.community.community_name }}<br>
                        {% endfor %}
                    </p>
                </div>
            {% endif %}
        </div>

        <div class="w-40 flex-this column align-right margin-top-16">

            <div class="flex-this margin-bottom-16 w-100 flex-end">
                
                {% if community %}
                    {% if member_role == 'viewer' %}
                    {% else %}
                        <div class="margin-right-1">
                            <a href="{% url 'apply-labels' community.id project.unique_id %}" class="action-btn">Apply Labels <i class="fa fa-plus" aria-hidden="true"></i> </a>
                        </div>
                    {% endif %}
                {% endif%}

                {% if institution %}
                    {% if project in institution.projects.all %}
                        {% if member_role == 'viewer' %}
                        {% else %}
                            <div class="margin-right-1">
                                <a href="{% url 'notify-communities' institution.id project.id %}" class="action-btn">
                                    Notify Communities <i class="fa fa-long-arrow-right"></i>
                                </a>
                            </div>
                        {% endif %}
                    {% endif %}
                {% endif %}

                {% if researcher %}
                    {% if project in researcher.projects.all %}
                        <div class="margin-right-1">
                            <a href="{% url 'researcher-notify-communities' researcher.id project.id %}" class="action-btn">
                                Notify Communities <i class="fa fa-long-arrow-right"></i>
                            </a>
                        </div>
                    {% endif %}
                {% endif %}

                <!-- TODO: can't see this button if labels applied to project, also only seen by creator of project -->
                {% if project.bclabels.all or project.tklabels.all %}

                {% else %}
                    {% if request.user == project.project_creator %}
                            <div class="margin-right-1">
                                {% if community %}
                                    <a href="{% url 'edit-project' community.id project.unique_id %}" class="action-btn">
                                        Edit Project <i class="fa fa-cog" aria-hidden="true"></i></a>
                                {% endif %}
                                {% if institution %}
                                    <a href="{% url 'inst-edit-project' institution.id project.unique_id %}" class="action-btn">
                                        Edit Project <i class="fa fa-cog" aria-hidden="true"></i></a>
                                {% endif %}                        
                                {% if researcher %}
                                    <a href="{% url 'researcher-edit-project' researcher.id project.unique_id %}" class="action-btn">
                                        Edit Project <i class="fa fa-cog" aria-hidden="true"></i></a>
                                {% endif %}                        
                            </div>
                        {% endif %}
                {% endif %}

                <div>
                    <a href="{% url 'view-project' project.unique_id %}" class="white-btn">Open Project <i class="fa fa-long-arrow-right"></i></a>
                </div>
            </div>
            <div class="flex-this row">
                {% if project.project_notice.all %}
                    {% for notice in project.project_notice.all %}
                        {% if notice.notice_type == 'biocultural' %}
                            <div><img src="{% static 'images/notices/bc-notice.png' %}" height="72px" width="72px"></div>
                        {% elif notice.notice_type == 'traditional_knowledge' %}
                            <div><img src="{% static 'images/notices/tk-notice.png' %}" height="72px" width="72px"></div>
                        {% elif notice.notice_type == 'traditional_knowledge' and notice.notice_type == 'biocultural' %}
                            <div><img src="{% static 'images/notices/bc-notice.png' %}" height="72px" width="72px"></div>
                            <div><img src="{% static 'images/notices/tk-notice.png' %}" height="72px" width="72px"></div>
                        {% endif %}
                    {% endfor %}
                {% endif %}
            </div>

        </div>

    </div>
</div>

{% endblock%}