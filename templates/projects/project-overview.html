{% extends 'base.html' %} {% block title %} Projects {% endblock %} {% load static %} {% load custom_project_tags %} {% block content %}

<div id="full-div-card-{{ project.unique_id }}" class="content-card-v2 content-card-space show">
    <div id="project-unique-{{ project.unique_id }}" class="flex-this space-between">

        <div class="w-60 flex-this column">
            <div>
                <a class="primary-black-text underline-hover"
                    {% if community %}
                        href="{% url 'community-project-actions' community.id project.unique_id %}" 
                    {% endif %}
                    {% if institution %}
                        href="{% url 'institution-project-actions' institution.id project.unique_id %}" 
                    {% endif %}
                    {% if researcher %}
                        href="{% url 'researcher-project-actions' researcher.id project.unique_id %}" 
                    {% endif %}
                >
                    <h2 class="no-bottom-margin no-top-margin">{{ project.title }}</h2>
                </a>
            </div>
            <div>
                <p>
                    {{ project.date_added|date:'M d, Y' }} | 
                    {% if project.project_type == 'Other' %} 
                        <span class="bold">{{ project.other_type }} </span>
                    {% else %} 
                        {{ project.project_type }} 
                    {% endif %}| 
                    {{ project.project_privacy }}<br>

                    {% for creator in project.project_creator_project.all %}

                        {% if community %}
                            {% if community == creator.community %}
                                <span class="bold">Created by</span>
                            {% else %}
                                <span class="bold">Shared by</span>
                            {% endif %}
                        {% endif %}

                        {% if institution %}
                            {% if institution == creator.institution %}
                                <span class="bold">Created by</span>
                            {% else %}
                                <span class="bold">Shared by</span>
                            {% endif %}
                        {% endif %}

                        {% if researcher %}
                            {% if researcher == creator.researcher %}
                                <span class="bold">Created by</span>
                            {% else %}
                                <span class="bold">Shared by</span>
                            {% endif %}
                        {% endif %}

                        {% if creator.community %}{{ creator.community }}{% endif %}
                        {% if creator.institution %}{{ creator.institution }}{% endif %}
                        {% if creator.researcher %}{{ creator.researcher }}{% endif %}
                    {% endfor %}
                </p>
            </div>
            
        </div>

        <div class="w-40 flex-this column align-right">
            <div class="flex-this margin-bottom-8 w-100 flex-end">

                <div class="text-align-right">
                    <a id="{{ project.unique_id }}" class="primary-btn white-btn" onclick='showMore(this)'>
                        Show More <i class="fa fa-angle-down" aria-hidden="true"></i>
                    </a>
                </div>

                <!-- TODO: set this up properly -->

                <div class="dropdown">
                    <a onclick="toggleKebabMenu(this)" id="kebab-{{ project.unique_id }}" class="kebab"><i class="fa-solid fa-ellipsis-vertical primary-black-text" style="font-size: 20px;"></i></a>
                    <div id="kebab-content-{{ project.unique_id }}" class="kebab-dropdown-content hide"> 

                        {% if request.user == project.project_creator %}
                            <span>
                                <div class="margin-right-1">
                                    <a
                                        class="darkteal-text"

                                        {% if community %}
                                            href="{% url 'edit-project' community.id project.unique_id %}"
                                        {% endif %}
                                        {% if institution %}
                                            href="{% url 'inst-edit-project' institution.id project.unique_id %}"
                                        {% endif %}                        
                                        {% if researcher %}
                                            href="{% url 'researcher-edit-project' researcher.id project.unique_id %}"
                                        {% endif %}   
                                    >
                                        Edit Project 
                                    </a>                   
                                </div>                                        
                            </span>
                        {% endif %}   
                        
                        <span>
                            <a class="darkteal-text" href="{% url 'download-project-zip' project.unique_id %}">
                                Download
                            </a>                                          
                        </span>
                    </div>
                </div>

            </div>
        </div>

    </div>

    <div id="expand-div-{{ project.unique_id }}" class="hide">


        {% if researcher or institution %}
            <div class="flex-this space-between border-top-solid-teal">

                <div class="w-70 margin-top-16">
                    <h3 class="no-bottom-margin no-top-margin">Notify Communities</h3>
                    <p>
                        Listed below are the communities you have notified about this project. After the name of the notified community is the status of their decision about the Project.<br><br>
                        The status options are:<br>
                        <i>Seen:</i> The community has acknowledged the Project but has not made a decision about applying Labels.
                        <i>No Labels Pending:</i> The community will not apply Labels to the Project.<br>
                        <i>Labels Pending:</i> The community is deciding which Label(s) to apply to the Project.<br>
                        <i>Labels Applied:</i> The community has applied Labels to the Project.
                    </p>
                </div>

                <div class="flex-this flex-end w-40 margin-top-16">
                    {% if institution %}
                        {% if institution.is_approved == False %}
                            <small class="margin-right-1 w-50 no-top-margin">In order to notify communities of your Project, your institution must be confirmed first.</small>
                        {% else %}
                            {% for creator in project.project_creator_project.all %}
                                {% if creator.institution %}
                                    {% if member_role == 'admin' or member_role == 'editor' %}
                                        <div class="margin-right-1">
                                            <a href="{% url 'institution-notify-others' institution.id project.unique_id %}" class="primary-btn action-btn">
                                                Notify Communities <i class="fa fa-users" aria-hidden="true"></i>
                                            </a>
                                        </div>
                                    {% endif %}
                                {% endif %}
                            {% endfor %}
                        {% endif %}
                    {% endif %}

                    {% if researcher %}
                        {% for creator in project.project_creator_project.all %}
                            {% if creator.researcher %}
                                <div class="margin-right-1">
                                    <a href="{% url 'researcher-notify-others' researcher.id project.unique_id %}" class="primary-btn action-btn">
                                        Notify Communities <i class="fa fa-users" aria-hidden="true"></i>
                                    </a>
                                </div>
                            {% endif %}
                        {% endfor %}
                    {% endif %}
                </div>            
            </div>
        {% endif %}

        <div class="flex-this column">

            {% which_communities_notified project as statuses %}
            {% if statuses %}
                <div>
                    <p>
                        <span class="bold">Notified Communities and Label Status</span><br>
                        {% for status in statuses %}
                            {{ status.community.community_name }} -- 
                            {% if not status.seen and status.status == None %} Sent <br>{% endif %}
                            {% if status.seen and status.status == None %} Seen <br>{% endif %}                            
                            {% if status.seen and status.status == 'pending' %} Labels Pending <br>{% endif %}
                            {% if status.seen and status.status == 'not_pending' %} No Labels Pending <br>{% endif %}
                            {% if status.seen and status.status == 'labels_applied' %} Labels Applied <br>{% endif %}
                        {% endfor %}
                    </p>
                </div>
            {% endif %}

            {% if community %}
                {% if not project_creator.community %}
                    {% include 'projects/project-status.html'%}
                {% endif %}
            {% endif %}

            {% include 'projects/project-comment.html'%}

        </div>
    
    </div>
</div>

{% endblock %}