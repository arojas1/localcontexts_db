{% extends 'base.html' %} {% block title %} | Projects {% endblock %} {% load static %} {% load custom_project_tags %} {% block content %}

<div id="full-div-card-{{ project.unique_id }}" class="content-card-v2 content-card-space white-bg">
    <div id="project-unique-{{ project.unique_id}}" class="flex-this space-between" style="scroll-margin-top: 8em;">

        <div class="w-60 flex-this column">
            <!-- title -->
            <div><h3 class="no-bottom-margin no-top-margin">{{ project.title }}</h3></div>
            <div><p>{{ project.date_added|date:'M d, Y' }} | 
                {{ project.project_type }} | 
                {{ project.project_privacy }}
                </p>
            </div>
            
            <div class="margin-bottom-16">
                <div class="flex-this">
                    {% if project.publication_doi %}
                        <div class="margin-right-1">
                            {% if not 'https://' in project.publication_doi %}
                                <a href="https://doi.org/{{ project.publication_doi }}" class="green-btn">{{ project.publication_doi }} <i class="fa fa-external-link" aria-hidden="true"></i></a></div>
                            {% else %}
                                <a href="{{ project.publication_doi }}" class="green-btn">{{ project.publication_doi }} <i class="fa fa-external-link" aria-hidden="true"></i></a></div>
                            {% endif %}
                    {% endif %}
                    {% if project.url %}
                        <div><a href="{{ project.url }}" class="green-btn">Project Link <i class="fa fa-external-link" aria-hidden="true"></i></a></div>
                    {% endif %}
                </div>
            </div>
        </div>

        <div class="w-40 flex-this column align-right margin-top-16">
            <div class="flex-this margin-bottom-8 w-100 flex-end">
                
                {% if community %}
                    {% if member_role == 'viewer' %}
                    {% else %}
                        <div class="margin-right-1">
                            <a href="{% url 'apply-labels' community.id project.unique_id %}" class="action-btn">Apply Labels <i class="fa fa-plus" aria-hidden="true"></i> </a>
                        </div>
                    {% endif %}
                {% endif%}

                <div class="margin-right-1">
                    <a href="{% url 'view-project' project.unique_id %}" class="white-btn">View Project <i class="fa fa-long-arrow-right"></i></a>
                </div>

                <div class="text-align-right">
                    <div class="white-btn"><a id="{{ project.unique_id }}" onclick='showMore(this)' class="darkteal-text pointer">
                            Show More <i class="fa fa-angle-down" aria-hidden="true"></i></a>
                    </div>
                </div>

                <div class="dropdown">
                    <a onclick="toggleMeatballMenu(this)" id="meatball-{{ project.unique_id }}" class="meatball"><i class="fa fa-ellipsis-h darkteal-text" style="font-size: 24px;"></i></a>
                    <div id="meatball-content-{{ project.unique_id }}" class="meatball-dropdown-content hide"> 
                        <span class="darkteal-text"> 
                            {% if project.bc_labels.all or project.tk_labels.all %}

                            {% else %}
                                    {% if request.user == project.project_creator %}
                                        <div class="margin-right-1">
                                            {% if community %}
                                                <a href="{% url 'edit-project' community.id project.unique_id %}">
                                                    Edit Project <i class="fa fa-cog" aria-hidden="true"></i></a>
                                            {% endif %}
                                            {% if institution %}
                                                <a href="{% url 'inst-edit-project' institution.id project.unique_id %}">
                                                    Edit Project <i class="fa fa-cog" aria-hidden="true"></i></a>
                                            {% endif %}                        
                                            {% if researcher %}
                                                <a href="{% url 'researcher-edit-project' researcher.id project.unique_id %}">
                                                    Edit Project <i class="fa fa-cog" aria-hidden="true"></i></a>
                                            {% endif %}                        
                                        </div>
                                    {% endif %}            
                            {% endif %}
                        </span>
                    </div>
                </div>

            </div>

            <div class="flex-this row margin-top-8 w-50 flex-end">
                {% if project.project_notice.all %}
                    <div class="flex-this flex-end w-60">
                        {% for notice in project.project_notice.all %}
                            {% if notice.notice_type == 'biocultural' %}
                                <div><img src="{% static 'images/notices/bc-notice.png' %}" height="72px" width="72px"></div>
                            {% elif notice.notice_type == 'traditional_knowledge' %}
                                <div><img src="{% static 'images/notices/tk-notice.png' %}" height="72px" width="72px"></div>
                            {% elif notice.notice_type == 'biocultural_and_traditional_knowledge' %}
                                <div><img src="{% static 'images/notices/bc-notice.png' %}" height="72px" width="72px"></div>
                                <div><img src="{% static 'images/notices/tk-notice.png' %}" height="72px" width="72px"></div>
                            {% endif %}
                        {% endfor %}
                    </div>
                {% endif %}
            </div>
        </div>

    </div>

    <div id="expand-div-{{ project.unique_id }}" class="hide">

        {% if researcher or institution %}
            <div class="flex-this space-between border-top-solid-teal">

                <div class="w-70 margin-top-16">
                    <h3 class="no-bottom-margin no-top-margin">Notify Communities</h3>
                    <p>
                        Listed below is an overview of the communities you have notified for this project. Here you can monitor the status on their decision that they make based on this project. The formal replies might be... <br><br>
                        <strong>Labels Pending:</strong> Which means that the community is going to apply Labels to this project or..<br>
                        <strong>No - Labels Pending:</strong> Which means that the community is not going to apply Labels to this project.<br><br>
                        You can message these communities directly in this section. Please remember to be kind. 
                    </p>
                </div>

                <div class="flex-this flex-end w-40 margin-top-16">
                    {% if institution %}
                        {% if project in institution.projects.all %}
                            {% if member_role == 'viewer' %}
                            {% else %}
                                <div class="margin-right-1">
                                    <a href="{% url 'institution-notify-others' institution.id project.id %}" class="action-btn">
                                        Notify Communities <i class="fa fa-users" aria-hidden="true"></i>
                                    </a>
                                </div>
                            {% endif %}
                        {% endif %}
                    {% endif %}

                    {% if researcher %}
                        {% if project in researcher.projects.all %}
                            <div class="margin-right-1">
                                <a href="{% url 'researcher-notify-others' researcher.id project.id %}" class="action-btn">
                                    Notify Communities <i class="fa fa-users" aria-hidden="true"></i>
                                </a>
                            </div>
                        {% endif %}
                    {% endif %}
                </div>            
            </div>
        {% endif %}

        <div class="flex-this column">

            {% which_communities_notified project as statuses %}
            {% if statuses %}
                <div>
                    <p>
                        <span class="bold">Communities Notified</span><br>
                        {% for status in statuses %}
                            {{ status.community.community_name }} - Seen: {{ status.seen }} - {{ status.status}} <br>
                        {% endfor %}
                    </p>
                </div>

            {% endif %}

            {% if community %}
                {% include 'projects/project-status.html'%}
            {% endif %}


            {% if project.project_notice.all %}
                {% for notice in project.project_notice.all %}
                    {% include 'projects/project-comment.html'%}
                {% endfor %}
            {% endif %}  
        </div>
    
    </div>


</div>

{% endblock%}