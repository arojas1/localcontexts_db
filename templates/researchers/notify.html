{% extends 'research-base.html' %} {% block title %} | Notify {% endblock %}{% load static %}{% load custom_researcher_tags %}{% block researcher_content %}

<div class="content-card content-card-space white-bg">

    <div class="flex-this space-between column">

        <div class="w-100 flex-this">

            <div class="w-50"> 
                    <h4 class="darkteal-text weight-600 no-top-margin">{{ project.title }}</h4>
                    <p class="no-top-margin">
                        {{ project.date_added|date:'M d Y' }} <br>
                        {{ project.project_type }} <br>
                        Project Contributors: 
                        
                        {% if project.project_contributors %}
                            {% for institution in project.project_contributors.institutions.all %}
                                {{ institution.institution_name }},
                            {% endfor %}
                            {% for community in project.project_contributors.communities.all %}
                                {{ community.community_name }},
                            {% endfor %}
                            {% for researcher in project.project_contributors.researchers.all %}
                                {{ researcher.user.get_full_name }},
                            {% endfor %}
                        {% endif %}

                        <br>
                    </p>
            </div>

            <div class="w-50 flex-this column">
                <div class="flex-this flex-end w-100">
                    <!-- <span class="darkteal-text">Show More</span> -->
                </div> 
            </div>

        </div>

    </div>

    <div>
        <div>
            {{ project.description }}
        </div>
    </div>

    <div>
        <p>
            Project Contact:  {{ project.project_contact }}<br>
            Project Contact Email:  {{ project.project_contact_email }}<br>
            Project URL: {{ project.url }}
        </p>
    </div>

    <hr>
    <h4 class="orange-text weight-600 no-top-margin">Send Requests</h4>
    <p>Once you have created a project, you can send this project to communities, institutions or researchers that could be interested in this project.</p>

    <form method="POST" action="">
        {% csrf_token %}

        {% if communities %}
        <label>Search our register</label><br>
            <select id="communities-select" class="width-492" onchange="selectCommunities()">
                <option>Select a Community</option>

                {% for community in communities %}
                    <!-- Custom templates to check if status for this project exists for bcnotice or tknotice -->
                    {% bcnotice_status_exists project community as bcnotice_status %}
                    {% tknotice_status_exists project community as tknotice_status %}

                    {% if bcnotice_status or tknotice_status %}
                    {% else %}
                        {% if community.is_publicly_listed %}
                            <option id="{{ community.id }}">{{ community.community_name }}</option>
                        {% endif %}
                    {% endif %}
                {% endfor %}
            </select>
            
            <p class="weight-500">Selected</p>
            {% for community in communities %}
                <div id="selected-community-{{ community.id }}" style="height: 0px; overflow: hidden;">
                    <div class="selected-community flex-this row space-between">
                        <div>
                            <p class="center-name">{{community.community_name}}</p>
                        </div>
                        <div>
                            <p id="close-{{ community.id }}" class="close-x darkteal-text pointer" onclick="cancelCommunitySelection(this)">&times;</p>
                        </div>
                    </div>
                </div>
                <div id="comm-id-input-{{ community.id }}" style="display: none;"></div>
            {% endfor %}
        {% endif %}
    
        <div class="margin-top-1">
            <label>Send a supporting message with this request</label><br>
            <textarea name="notice_message" style="width: 400px; height: 200px;"></textarea>
        </div>
    
        <button class="action-btn">Notify <i class="fa fa-users" aria-hidden="true"></i></button>

    </form>




</div>

{% endblock %}