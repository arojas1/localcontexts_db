{% extends 'account-base.html' %} {% block title %} Update {% endblock %}{% load static %}{% block researcher_content %}
    <!-- import ORCiD Widget -->
    <script src="{% static 'javascript/orcid-widget.js' %}" type="text/javascript" defer></script>

    <div class="content-card content-card-space white-bg flex-this column">
        <h2 class="no-top-margin">Account Settings</h2>

        <div class="flex-this w-100">

            <div class="side-nav-container">
                
                <a href="{% url 'update-researcher' researcher.id %}">
                    {% if 'update' in request.path %} 
                    <div class="flex-this side-nav-item selected">
                    {% else %}
                    <div class="flex-this side-nav-item grey-text">
                    {% endif %}
                        <div class="w-20 margin-right-8"><i class="fa fa-user fa-3x" aria-hidden="true"></i></div>
                        <div class="w-80">
                            <p class="no-top-margin"><strong>Researcher Account</strong><br>Contact email, primary institution, description</p>
                        </div>  
                    </div>   
                </a>

            </div>
    
            <div class="flex-this column w-80">

                    <div class="flex-this space-between w-70">
                        <div><h3 class="no-top-margin">Contact Information</h3></div>
                        <div>Account ID: {{ researcher.id }}</div>
                    </div>
    
                    <div class="w-70">
                        <form method="POST" action="{% url 'update-researcher' researcher.id %}" enctype="multipart/form-data">
                            {% csrf_token %}

                            <div class="w-100">
                                <div class="w-50">
                                    <label for="contact_email"> Contact Email </label><br> 
                                    {{ update_form.contact_email }}
                                </div>                                   

                                {% if update_form.contact_email.errors %}
                                    <div class="msg-red w-50"><small>{{ update_form.contact_email.errors.as_text }}</small></div> 
                                {% endif %}
                            </div>

                            <div class="margin-top-16">
                                {{ update_form.contact_email_public.label }}
                                {{ update_form.contact_email_public }}

                                {% if update_form.contact_email_public.errors %}
                                    <div class="msg-red w-50"><small>{{ update_form.contact_email_public.errors.as_text }}</small></div> 
                                {% endif %}
                            </div>  

                            <div><h3>Additional Information</h3></div>

                            <div class="w-100 margin-top-8">
                                <div class="flex-this">
                                    <div class="w-50 margin-right-1">
                                        <label for="primary_institution"> Primary Institution </label><br>
                                        {{ update_form.primary_institution }}
                                    </div>
                                    <div class="w-50">
                                        {{ update_form.website.label }} <br>
                                        {{ update_form.website }}
                                    </div>                                        
                                </div>

                                {% if update_form.primary_institution.errors %}
                                    <div class="msg-red w-50"><small>{{ update_form.primary_institution.errors.as_text }}</small></div> 
                                {% endif %}
                                {% if update_form.website.errors %}
                                    <div class="msg-red w-50"><small>{{ update_form.website.errors.as_text }}</small></div> 
                                {% endif %}
                            </div>

                            <div class="w-100 margin-top-8">
                                {{ update_form.description.label }}
                                {{ update_form.description }}
                                {% if update_form.description.errors %}
                                    <div class="msg-red w-80"><small>{{ update_form.description.errors.as_text }}</small></div> 
                                {% endif %}
                            </div>

                            <div class="w-50 margin-top-8">
                                {{ update_form.image.label }} <br>
                                {{ update_form.image }}
                                {% if update_form.image.errors %}
                                    <div class="msg-red w-50"><small>{{ update_form.image.errors.as_text }}</small></div> 
                                {% endif %}
                            </div>

                            <br>
                            <label class="bold">ORCiD</label>

                            {% if researcher.orcid %}
                                <div class="flex-this space-between">
                                    <div>
                                        <div itemscope itemtype="https://schema.org/Person">
                                            <a 
                                                class="darkteal-text underline-hover" 
                                                itemprop="sameAs" 
                                                target="orcid.widget" 
                                                rel="me noopener noreferrer" 
                                                style="vertical-align:top;"
                                                {% if 'https://sandbox.orcid.org/' in researcher.orcid or 'https://orcid.org/' in researcher.orcid %}
                                                    content="{{ researcher.orcid }}" 
                                                    href="{{ researcher.orcid }}" 
                                                {% elif 'X' in researcher.orcid %}
                                                    content="https://sandbox.orcid.org/{{ researcher.orcid }}" 
                                                    href="https://sandbox.orcid.org/{{ researcher.orcid }}"
                                                {% else %}
                                                    content="https://orcid.org/{{ researcher.orcid }}" 
                                                    href="https://orcid.org/{{ researcher.orcid }}" 
                                                {% endif %}
                                            >
                                                <img loading="lazy" src="https://orcid.org/sites/default/files/images/orcid_16x16.png" style="width:1em;margin-right:.5em;" alt="ORCID iD icon">
                                                {% if 'https://sandbox.orcid.org/' in researcher.orcid or 'https://orcid.org/' in researcher.orcid %}
                                                    {{ researcher.orcid }}
                                                {% elif 'X' in researcher.orcid %}
                                                    https://sandbox.orcid.org/{{ researcher.orcid }} 
                                                {% else %}
                                                    https://orcid.org/{{ researcher.orcid }}
                                                {% endif %}
                                            </a>
                                        </div>                                
                                    </div>

                                    <div>
                                        <a class="primary-btn white-btn" href="{% url 'disconnect-orcid' %}">Disconnect ORCiD</a>
                                    </div> 
                                </div>

                            {% else %}
                                <div class="flex-this space-between">
                                    <div class="w-50"><p>We encourage you to have an ORCiD ID. <br>You can <a class="darkteal-text underline-hover" href="https://orcid.org/" target="_blank" rel="noopener">read more about ORCiD here</a>.</p></div>
                                    <!-- Show ORCiD widget based on hostname -->
                                    <div 
                                        id="orcidWidget" 
                                        {% if 'localcontextshub' in request.get_host %}
                                            data-clientid='APP-IBW6UOF5FGJG0ODB' 
                                            data-env="production" 
                                            data-redirecturi="https://localcontextshub.org/researchers/connect-orcid/"
                                        {% elif 'localhost' in request.get_host %}
                                            data-clientid='APP-6SAN29B74JQ6FEUQ' 
                                            data-env="sandbox" 
                                            data-redirecturi="http://localhost:8000/researchers/connect-orcid/"
                                        {% elif 'anth-ja77-local-contexts-8985' in request.get_host %}
                                            data-clientid='APP-IBW6UOF5FGJG0ODB' 
                                            data-env="production" 
                                            data-redirecturi="https://anth-ja77-local-contexts-8985.uc.r.appspot.com/researchers/connect-orcid/"
                                        {% elif 'anth-ja77-lc-dev-42d5' in request.get_host %}
                                            data-clientid='APP-6SAN29B74JQ6FEUQ' 
                                            data-env="sandbox" 
                                            data-redirecturi="https://anth-ja77-lc-dev-42d5.uc.r.appspot.com/researchers/connect-orcid/"
                                        {% endif %}
                                    >
                                    </div>
                                </div>
                        
                                {% if 'anth-ja77-lc-dev-42d5' in request.get_host %}
                                    <small class="bold">Please note that since this is a test site, the ORCiD used will be the <a class="darkteal-text underline-hover" href="https://sandbox.orcid.org/">sandbox version</a>.</small><br>
                                {% elif 'localhost' in request.get_host %}
                                    <small class="bold">Localhost uses the <a class="darkteal-text underline-hover" href="https://sandbox.orcid.org/">sandbox version</a> of ORCiD.</small><br>
                                {% endif %}
                            {% endif %}

                            {% include 'partials/_alerts.html' %}

                            <div class="flex-this space-between w-100">
                                <div class="margin-top-16 w-40">
                                    <button class="primary-btn action-btn margin-top-2  default-btn-width">Save</button>
                                </div>
                                <p>
                                    <small class="grey-text">Providing your personal information is optional.
                                        By providing it, you consent for it to be shown to other Hub users, see the <a href="https://localcontexts.org/privacy-policy/" class="darkteal underline-hover" target="_blank" rel="noopener">Privacy Policy <i class="fa fa-external-link fa-xs" aria-hidden="true"></i></a>.</small>
                                </p>  
                            </div>
                            
                        </form>
                    </div>
    
                </div>
        </div>

    </div>

{% endblock %}